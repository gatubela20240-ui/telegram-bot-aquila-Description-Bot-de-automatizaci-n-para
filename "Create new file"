"""
BOT DE TELEGRAM - AQUILA DIGITAL
AutomatizaciÃ³n de publicaciones para canales gratuito y VIP
"""

import os
import logging
from datetime import datetime, time
from telegram import Bot
from telegram.error import TelegramError
import asyncio
import pytz

# ==================== CONFIGURACIÃ“N ====================

# IMPORTANTE: Configura estas variables en Render como variables de entorno
BOT_TOKEN = os.environ.get('BOT_TOKEN', 'TU_TOKEN_AQUI')
CANAL_GRATUITO = os.environ.get('CANAL_GRATUITO', '@aquiladigital')  # Ejemplo: @aquiladigital
CANAL_VIP = os.environ.get('CANAL_VIP', '@aquila')  # Ejemplo: @aquila
TIMEZONE = 'America/Bogota'  # Ajusta segÃºn tu zona horaria

# Configurar logging
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# ==================== CONTENIDOS ====================

# Estructura: {dia: {canal: {tipo, contenido}}}
CONTENIDOS = {
    1: {  # LUNES
        'gratuito': {
            'tipo': 'texto',
            'contenido': """ğŸ’° Resultados reales de productos digitales creados con IA

Hace 6 meses no sabÃ­a nada de inteligencia artificial...

Hoy mis productos generan ingresos pasivos mientras duermo.

La diferencia no fue "suerte" ni "inversiÃ³n"...

Fue aprender el SISTEMA correcto.

ğŸ”¥ En Aquila (VIP) te muestro TODO el proceso tÃ©cnico paso a paso.

Pero aquÃ­ te dejo este insight:

â¡ï¸ El 80% de las personas crean productos pero NO saben venderlos.
â¡ï¸ Yo te enseÃ±o ambas cosas: CREAR + VENDER.

Â¿Quieres resultados como estos? 
Primero aprende el mÃ©todo. ğŸ‘‡"""
        },
        'vip': {
            'tipo': 'texto',
            'contenido': """ğŸ¯ SESIÃ“N 1: CÃ³mo elegir el producto digital correcto para TU audiencia

Bienvenido a Aquila ğŸ”¥

Hoy arrancamos con lo mÃ¡s importante:

NO todos los productos digitales funcionan para todos.

Te voy a enseÃ±ar mi framework de 3 preguntas:

1ï¸âƒ£ Â¿Tu audiencia tiene un problema especÃ­fico que puedes resolver?
2ï¸âƒ£ Â¿EstÃ¡s dispuesto a crear contenido sobre ese tema por 6+ meses?
3ï¸âƒ£ Â¿Ese producto se puede crear/mejorar con IA?

Si las 3 respuestas son SÃ â†’ Tienes un ganador.

ğŸ“ Descarga la plantilla de validaciÃ³n en el grupo

ğŸ™ï¸ Escucha el audio que subÃ­ con casos reales (7 min)

Escucha, descarga y maÃ±ana analizamos TU idea especÃ­fica.

Â¿Preguntas? EscrÃ­beme directo aquÃ­ ğŸ‘‡"""
        }
    },
    2: {  # MARTES
        'gratuito': {
            'tipo': 'texto',
            'contenido': """ğŸ¤– Las 5 herramientas de IA que uso TODOS los dÃ­as para crear productos digitales

1. ChatGPT â†’ Guiones, copys, estructuras
2. Midjourney â†’ ImÃ¡genes profesionales en segundos
3. Canva con IA â†’ DiseÃ±os automÃ¡ticos
4. ElevenLabs â†’ Voces realistas para audios
5. Notion AI â†’ OrganizaciÃ³n y automatizaciÃ³n

La mayorÃ­a son GRATIS o tienen versiones gratuitas.

El problema no es la herramienta...

Es NO saber QUÃ‰ crear y CÃ“MO venderlo.

En Aquila (VIP) te enseÃ±o el sistema completo:
âœ… QuÃ© productos crear
âœ… CÃ³mo crearlos con IA
âœ… CÃ³mo venderlos en redes sociales
âœ… CÃ³mo escalar tus ingresos

Herramientas = 10% del Ã©xito
Estrategia = 90% del Ã©xito

Â¿Quieres la estrategia? EscrÃ­beme "INFO" ğŸ‘‡"""
        },
        'vip': {
            'tipo': 'texto',
            'contenido': """ğŸ› ï¸ SESIÃ“N 2: Mi plantilla exacta de prompts para crear productos digitales con ChatGPT

Hoy te regalo algo que me tomÃ³ MESES perfeccionar:

ğŸ“ Mis 15 prompts definitivos para crear:
- E-books
- Cursos digitales
- GuÃ­as paso a paso
- Scripts de videos
- Copys de ventas

Estos prompts ya tienen la estructura correcta.

Solo cambias el tema y ChatGPT te genera contenido profesional.

âš ï¸ IMPORTANTE: Estos prompts incluyen:
âœ… Contexto del avatar
âœ… Tono de comunicaciÃ³n
âœ… Estructura especÃ­fica
âœ… Llamados a la acciÃ³n

NO son los prompts bÃ¡sicos que encuentras en internet.

ğŸ“¥ Descarga el documento y Ãºsalos hoy mismo.

MaÃ±ana vemos cÃ³mo DISEÃ‘AR ese contenido visualmente con IA.

Â¿Dudas con algÃºn prompt? Pregunta aquÃ­ ğŸ‘‡"""
        }
    },
    3: {  # MIÃ‰RCOLES
        'gratuito': {
            'tipo': 'texto',
            'contenido': """âš¡ "No necesitas ser experto para vender productos digitales.

Necesitas ser estratÃ©gico."

Este fue el mindset que cambiÃ³ mi juego.

Cuando empecÃ© pensaba:
âŒ "No sÃ© lo suficiente"
âŒ "Hay mucha competencia"
âŒ "Necesito invertir miles"

La realidad:
âœ… Tus primeros $100 los haces siendo ÃšTIL, no experto
âœ… La competencia no sabe vender (tÃº sÃ­ aprenderÃ¡s)
âœ… Con $0 puedes arrancar usando IA

En Aquila (VIP) te muestro:

ğŸ“ CÃ³mo crear tu primer producto digital ESTA semana
ğŸ“ CÃ³mo validarlo antes de perder tiempo
ğŸ“ CÃ³mo venderlo en redes sociales sin pagar ads

No es teorÃ­a. Es lo que YO hago todos los dÃ­as.

Â¿EstÃ¡s listo para dar el salto? ğŸš€"""
        },
        'vip': {
            'tipo': 'texto',
            'contenido': """ğŸ¨ SESIÃ“N 3: CÃ³mo diseÃ±ar tu producto digital en menos de 2 horas usando Canva + IA

Hoy vamos directo a la acciÃ³n.

Te voy a enseÃ±ar mi proceso EXACTO para diseÃ±ar:
- Portadas profesionales
- PÃ¡ginas interiores de e-books
- Slides de presentaciones
- Posts para promocionar en redes

ğŸ”§ HERRAMIENTAS:
- Canva (gratis)
- ChatGPT para textos
- Remove.bg para recortar imÃ¡genes

â±ï¸ TIEMPO REAL: 1 hora 45 minutos

âœ… RESULTADO: Un e-book de 20 pÃ¡ginas listo para vender

ğŸ“ BONUS: Revisa la carpeta compartida con 50 plantillas pre-diseÃ±adas.

SÃ­guelo tal cual te muestro y tendrÃ¡s tu producto listo HOY.

Â¿Lo hiciste? Comparte tu resultado aquÃ­ ğŸ‘‡"""
        }
    },
    4: {  # JUEVES
        'gratuito': {
            'tipo': 'texto',
            'contenido': """ğŸ¤” Pregunta del dÃ­a

He hablado con +200 personas que quieren vender productos digitales...

Y TODOS tienen uno de estos 4 problemas:

1ï¸âƒ£ No saben QUÃ‰ crear
2ï¸âƒ£ No saben CÃ“MO venderlo
3ï¸âƒ£ No tienen AUDIENCIA
4ï¸âƒ£ No saben usar las HERRAMIENTAS

AquÃ­ va la verdad dura:

âŒ Si no sabes quÃ© crear â†’ Nunca empezarÃ¡s
âŒ Si no sabes venderlo â†’ CrearÃ¡s productos que nadie compra
âŒ Si no tienes audiencia â†’ VenderÃ¡s al vacÃ­o
âŒ Si no usas las herramientas â†’ TardarÃ¡s 10x mÃ¡s

En Aquila (VIP) resolvemos los 4 en orden:

âœ… Identificas tu producto ganador (DÃ­a 1-2)
âœ… Aprendes a crearlo con IA (DÃ­a 3-5)
âœ… Construyes audiencia orgÃ¡nica (DÃ­a 6-10)
âœ… Lanzas y vendes tu primer producto (DÃ­a 11-14)

No es un curso de 6 meses. Es mentorÃ­a de 14 dÃ­as para tu primer venta.

Â¿CuÃ¡l es TU mayor obstÃ¡culo? EscrÃ­beme ğŸ‘‡"""
        },
        'vip': {
            'tipo': 'texto',
            'contenido': """ğŸ’° SESIÃ“N 4: El sistema de ventas en frÃ­o que me genera 15-20 ventas al mes SIN anuncios pagos

Esto es GOLD puro ğŸ”¥

Hoy te revelo mi embudo completo:

ğŸ™ï¸ CÃ³mo estructuro mi sistema de ventas orgÃ¡nicas:
- Por quÃ© Instagram/TikTok NO son suficientes
- El poder de WhatsApp + Telegram para cerrar ventas
- Mi script exacto de seguimiento
- CÃ³mo manejo objeciones sin ser vendedor insistente

Esto NO es teorÃ­a de marketing...

Es mi proceso del dÃ­a a dÃ­a:

1ï¸âƒ£ Contenido de valor en redes (3-5 posts/dÃ­a)
2ï¸âƒ£ CTA hacia WhatsApp/Telegram
3ï¸âƒ£ ConversaciÃ³n 1 a 1 humanizada
4ï¸âƒ£ Cierre natural de la venta
5ï¸âƒ£ Entrega inmediata del producto

ğŸ”‘ CLAVE: El 80% de mis ventas ocurren en conversaciones privadas, NO en comentarios pÃºblicos.

Revisa el documento del embudo y maÃ±ana hacemos tu versiÃ³n personalizada.

Â¿Preguntas? EscrÃ­beme directo ğŸ‘‡"""
        }
    },
    5: {  # VIERNES
        'gratuito': {
            'tipo': 'texto',
            'contenido': """âœ¨ Caso real: De 0 a su primera venta en 9 dÃ­as

ğŸ“© Me llegÃ³ este mensaje ayer:

"Hace 9 dÃ­as no tenÃ­a ni idea de cÃ³mo crear un producto digital. Hoy vendÃ­ mi primer e-book a $27. Gracias por enseÃ±arme el sistema completo."

Â¿QuÃ© hizo diferente?

1ï¸âƒ£ DejÃ³ de consumir contenido aleatorio
2ï¸âƒ£ SiguiÃ³ UN mÃ©todo probado (el mÃ­o)
3ï¸âƒ£ ImplementÃ³ en vez de solo aprender
4ï¸âƒ£ UsÃ³ IA para acelerar el proceso

NO fue suerte. Fue seguir el proceso correcto.

En Aquila (VIP) te doy el mismo sistema:

âœ… CreaciÃ³n de producto con IA
âœ… Estrategia de contenido para vender
âœ… Copy de ventas probado
âœ… MentorÃ­a directa cuando te trancas

Este fin de semana muchos van a "investigar" sobre productos digitales...

Pero solo unos pocos van a CREAR su primer producto.

Â¿De quÃ© lado quieres estar? ğŸš€

EscrÃ­beme "QUIERO EMPEZAR" y hablamos."""
        },
        'vip': {
            'tipo': 'texto',
            'contenido': """ğŸ¥ SESIÃ“N 5: RevisiÃ³n 1 a 1 - Analizo TU proyecto en vivo

Es viernes y es momento de revisar tu progreso ğŸ’ª

Hoy hacemos algo diferente:

ğŸ“¹ Analizo 3 productos que estÃ¡n creando miembros de Aquila:

- QuÃ© estÃ¡ bien
- QuÃ© hay que mejorar
- Ajustes rÃ¡pidos para vender mÃ¡s

ğŸ‘€ Si tu producto aparece en la revisiÃ³n, recibirÃ¡s feedback directo.

ğŸ”¥ IMPORTANTE: Si aÃºn NO has empezado tu producto, este es el momento.

ğŸ“‹ TAREA PARA EL FIN DE SEMANA:

1ï¸âƒ£ Define tu producto final (tipo, formato, precio)
2ï¸âƒ£ Crea el contenido usando los prompts que te di
3ï¸âƒ£ DiseÃ±a la portada y estructura bÃ¡sica
4ï¸âƒ£ Sube un avance al grupo para feedback

El lunes hacemos sesiÃ³n de copy de ventas + estrategia de lanzamiento.

Para el miÃ©rcoles, deberÃ­as estar vendiendo.

Â¿Necesitas ayuda con algo especÃ­fico? EscrÃ­beme AHORA ğŸ‘‡

(Recuerda: AquÃ­ no hay preguntas tontas, solo gente que no pregunta y se queda estancada)"""
        }
    },
    6: {  # SÃBADO
        'gratuito': {
            'tipo': 'texto',
            'contenido': """ğŸ’­ ReflexiÃ³n de sÃ¡bado

Hoy no voy a venderte nada.

Solo quiero que pienses en esto:

Â¿CuÃ¡ntos cursos/videos/posts has consumido sobre "cÃ³mo ganar dinero online" en los Ãºltimos 6 meses?

Ahora pregÃºntate:

Â¿CuÃ¡ntos productos digitales has CREADO y VENDIDO en esos 6 meses?

Si la respuesta es 0... no es tu culpa.

El 90% del contenido en internet te enseÃ±a TEORÃA.

Muy pocos te enseÃ±an IMPLEMENTACIÃ“N.

Por eso creÃ© Aquila (VIP):

No es un curso.
No es contenido grabado.
No es motivaciÃ³n vacÃ­a.

Es mentorÃ­a directa donde:

âœ… Yo creo contigo
âœ… TÃº implementas conmigo
âœ… Resolvemos tus obstÃ¡culos en tiempo real

Este fin de semana vas a consumir mÃ¡s contenido...

Â¿O este fin de semana vas a CREAR tu primer producto?

La decisiÃ³n es tuya ğŸ”‘

(Si eliges crear, escrÃ­beme y arrancamos)"""
        },
        'vip': {
            'tipo': 'texto',
            'contenido': """ğŸ“¦ RECURSO SEMANAL: Kit completo de assets visuales para tus productos

Buen sÃ¡bado, equipo ğŸ’ª

Hoy les dejo un recurso que me pidieron mucho:

ğŸ“ KIT DE ASSETS:
- 100 mockups de productos digitales
- 50 fondos profesionales para portadas
- 30 iconos para diseÃ±o interior
- 20 plantillas de Instagram para promocionar productos

Todo listo para usar en Canva o Photoshop.

ğŸ¯ CÃ“MO USARLO:

1. Descarga el ZIP de la carpeta compartida
2. Importa los assets a tu Canva
3. Arrastra y personaliza segÃºn tu marca

â° AHORRA: 5-7 horas de bÃºsqueda de recursos

ğŸ“Š CHECK-IN SEMANAL:

Responde en los comentarios:

1ï¸âƒ£ Â¿QuÃ© lograste esta semana?
2ï¸âƒ£ Â¿DÃ³nde te trabaste?
3ï¸âƒ£ Â¿QuÃ© necesitas para la semana que viene?

Voy a leer cada respuesta y personalizar el contenido de la prÃ³xima semana segÃºn lo que necesiten.

Este grupo es ACTIVO o no sirve.

Te leo ğŸ‘‡"""
        }
    },
    7: {  # DOMINGO
        'gratuito': {
            'tipo': 'texto',
            'contenido': """ğŸ”¥ Resumen de la semana: Lo que aprendimos

Esta semana hablamos de:

âœ… Resultados reales de productos digitales
âœ… Las 5 herramientas de IA que uso diariamente
âœ… El mindset correcto para empezar
âœ… Los 4 obstÃ¡culos principales
âœ… Un caso de Ã©xito real: $27 en 9 dÃ­as

Y todo esto fue solo GRATIS en este canal.

Ahora imagina lo que pasa en Aquila (VIP):

ğŸ’ Tutoriales paso a paso
ğŸ’ Plantillas editables
ğŸ’ Feedback personalizado
ğŸ’ MentorÃ­a directa
ğŸ’ Comunidad activa

La diferencia entre saber y HACER estÃ¡ en la implementaciÃ³n.

ğŸ¯ PREGUNTA PARA TI:

Â¿QuÃ© vas a hacer diferente esta semana?

Â¿Vas a seguir consumiendo contenido gratis...
O vas a invertir en ti y crear tu primer producto digital esta semana?

El grupo VIP tiene cupos limitados para mantener la atenciÃ³n personalizada.

Si quieres apartar tu lugar, escrÃ­beme "LISTO" y te mando los detalles ğŸš€

Nos vemos maÃ±ana con energÃ­a renovada ğŸ’ª"""
        },
        'vip': {
            'tipo': 'texto',
            'contenido': """ğŸ™ï¸ AUDIO DOMINICAL: PreparaciÃ³n mental para la semana de implementaciÃ³n

Buen domingo, familia Aquila ğŸ”¥

Hoy sin tutoriales tÃ©cnicos.

Solo quiero hablar contigo de TÃš a TÃš:

En este mensaje te cuento:

- Por quÃ© los domingos son clave para planificar
- Mi ritual semanal de productividad
- CÃ³mo evitar la parÃ¡lisis por anÃ¡lisis
- La mentalidad de "hecho es mejor que perfecto"

ğŸ“… PLAN PARA LA PRÃ“XIMA SEMANA:

LUNES: Copy de ventas - CÃ³mo escribir textos que venden
MARTES: Estrategia de contenido orgÃ¡nico en Instagram/TikTok
MIÃ‰RCOLES: Lanzamiento suave - CÃ³mo vender sin "gritar" tu producto
JUEVES: Manejo de objeciones y cierre de ventas
VIERNES: Escalamiento - De 1 venta a 10 ventas por semana

ğŸ“Š META DE LA SEMANA:

Que al menos 5 personas del grupo hagan su PRIMERA VENTA.

Si ya vendiste, la meta es duplicar tus ventas.

ğŸ”‘ RECUERDA: No estÃ¡s solo en esto. AquÃ­ estamos todos empujando juntos.

Disfruta tu domingo, descansa bien y el lunes arrancamos con todo ğŸ’ª

Â¿Listo para la semana? Reacciona con ğŸ”¥"""
        }
    }
}

# ==================== FUNCIONES ====================

async def enviar_mensaje(bot, canal, contenido):
    """EnvÃ­a un mensaje a un canal especÃ­fico"""
    try:
        await bot.send_message(
            chat_id=canal,
            text=contenido,
            parse_mode='HTML'
        )
        logger.info(f"âœ… Mensaje enviado a {canal}")
        return True
    except TelegramError as e:
        logger.error(f"âŒ Error al enviar mensaje a {canal}: {e}")
        return False

async def publicar_contenido_diario():
    """Publica el contenido del dÃ­a segÃºn el ciclo de 7 dÃ­as"""
    bot = Bot(token=BOT_TOKEN)
    
    # Determinar quÃ© dÃ­a del ciclo es (1-7)
    hoy = datetime.now(pytz.timezone(TIMEZONE))
    dia_ciclo = (hoy.day % 7) + 1  # Ciclo de 1 a 7
    
    logger.info(f"ğŸ“… DÃ­a del ciclo: {dia_ciclo}")
    
    # Obtener contenido del dÃ­a
    contenido_dia = CONTENIDOS.get(dia_ciclo)
    
    if not contenido_dia:
        logger.error(f"âŒ No hay contenido para el dÃ­a {dia_ciclo}")
        return
    
    # Publicar en canal gratuito
    contenido_gratis = contenido_dia['gratuito']['contenido']
    await enviar_mensaje(bot, CANAL_GRATUITO, contenido_gratis)
    
    # Publicar en canal VIP
    contenido_vip = contenido_dia['vip']['contenido']
    await enviar_mensaje(bot, CANAL_VIP, contenido_vip)
    
    logger.info("âœ… Publicaciones del dÃ­a completadas")

async def verificar_hora_publicacion():
    """Verifica si es hora de publicar (10:00 AM)"""
    tz = pytz.timezone(TIMEZONE)
    while True:
        ahora = datetime.now(tz)
        hora_objetivo = time(10, 0)  # 10:00 AM
        
        if ahora.time().hour == hora_objetivo.hour and ahora.time().minute == hora_objetivo.minute:
            logger.info("â° Es hora de publicar!")
            await publicar_contenido_diario()
            # Esperar 2 minutos para no publicar mÃºltiples veces
            await asyncio.sleep(120)
        
        # Verificar cada minuto
        await asyncio.sleep(60)

async def main():
    """FunciÃ³n principal del bot"""
    logger.info("ğŸš€ Bot iniciado - Esperando hora de publicaciÃ³n (10:00 AM)")
    logger.info(f"ğŸ“¡ Canal Gratuito: {CANAL_GRATUITO}")
    logger.info(f"ğŸ’ Canal VIP: {CANAL_VIP}")
    
    try:
        await verificar_hora_publicacion()
    except KeyboardInterrupt:
        logger.info("ğŸ›‘ Bot detenido manualmente")
    except Exception as e:
        logger.error(f"âŒ Error crÃ­tico: {e}")

if __name__ == "__main__":
    # Verificar que el token estÃ© configurado
    if BOT_TOKEN == 'TU_TOKEN_AQUI':
        logger.error("âŒ ERROR: Debes configurar el BOT_TOKEN en las variables de entorno")
        exit(1)
    
    # Ejecutar el bot
    asyncio.run(main())
